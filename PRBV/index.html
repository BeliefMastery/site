<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Patons Rock Beach Villas - Bookings</title>
  <script src="https://cdn.jsdelivr.net/npm/ical.js@1.5.0/build/ical.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    .villa-card {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .villa-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
    }
  </style>
</head>
<body class="bg-gradient-to-b from-blue-50 to-white text-gray-800 font-sans">
  <div class="max-w-6xl mx-auto p-6">
    <h1 class="text-4xl font-bold mb-4 text-center text-indigo-800">Patons Rock Beach Villas</h1>
    <p class="text-lg mb-10 text-center text-gray-700 max-w-3xl mx-auto">
      Welcome to Patons Rock Beach Villas, your beachfront escape in Golden Bay. Nestled just steps from the sand, each villa offers comfort, privacy, and direct access to one of New Zealandâ€™s most beautiful coastlines. Below you can view the upcoming bookings for each villa over the next four days, to help you plan your perfect seaside stay.
    </p>

    <div id="calendar-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
  </div>

  <script>
    const calendars = [
      { name: "Villa 1", url: "https://github.com/BeliefMastery/site/blob/main/PRBV//ical-proxy.php?url=" + encodeURIComponent("https://api.beds24.com/ical/bookings.ics?roomid=318483&token=ea7b37ea5fc562875d2a5196a1a77ed8&showtime=true") },
      { name: "Villa 2", url: "https://github.com/BeliefMastery/site/blob/main/PRBV//ical-proxy.php?url=" + encodeURIComponent("https://api.beds24.com/ical/bookings.ics?roomid=318484&token=619894678ee80521412a314854aba411&showtime=true") },
      { name: "Villa 3", url: "https://github.com/BeliefMastery/site/blob/main/PRBV//ical-proxy.php?url=" + encodeURIComponent("https://api.beds24.com/ical/bookings.ics?roomid=318485&token=0dc12d488822f3fb0487273a4d933c84&showtime=true") },
      { name: "Villa 4", url: "https://github.com/BeliefMastery/site/blob/main/PRBV//ical-proxy.php?url=" + encodeURIComponent("https://api.beds24.com/ical/bookings.ics?roomid=318486&token=9634a496cdf402a5c88b5685866a00e8&showtime=true") }
    ];

    const today = luxon.DateTime.local().startOf("day");
    const endDate = today.plus({ days: 4 });

    async function fetchCalendar(url) {
      const response = await fetch(url);
      const text = await response.text();
      return new ICAL.Component(ICAL.parse(text));
    }

    function getEvents(comp) {
      const vevents = comp.getAllSubcomponents("vevent");
      return vevents.map(v => new ICAL.Event(v));
    }

    function filterUpcoming(events) {
      return events.filter(e => {
        const start = luxon.DateTime.fromJSDate(e.startDate.toJSDate());
        return start >= today && start < endDate;
      });
    }

    function renderCalendar(name, events) {
      const container = document.getElementById("calendar-container");
      const card = document.createElement("div");
      card.className = "villa-card bg-white rounded-2xl shadow-lg p-5 flex flex-col";

      const header = document.createElement("h2");
      header.className = "text-2xl font-semibold mb-4 text-indigo-700 text-center";
      header.textContent = name;
      card.appendChild(header);

      if (events.length === 0) {
        const empty = document.createElement("p");
        empty.className = "text-gray-500 text-center";
        empty.textContent = "No bookings in the next 4 days.";
        card.appendChild(empty);
      } else {
        const list = document.createElement("ul");
        list.className = "space-y-2";

        events.forEach(e => {
          const li = document.createElement("li");
          li.className = "bg-indigo-50 p-2 rounded-lg border border-indigo-100 text-sm";
          const start = luxon.DateTime.fromJSDate(e.startDate.toJSDate());
          li.textContent = `${start.toFormat("ccc dd LLL")} - ${e.summary}`;
          list.appendChild(li);
        });

        card.appendChild(list);
      }

      container.appendChild(card);
    }

    async function init() {
      for (const cal of calendars) {
        try {
          const comp = await fetchCalendar(cal.url);
          const events = getEvents(comp);
          const filtered = filterUpcoming(events);
          renderCalendar(cal.name, filtered);
        } catch (err) {
          console.error("Error loading calendar", cal.name, err);
        }
      }
    }

    init();
  </script>
</body>
</html>
